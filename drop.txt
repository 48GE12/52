import socket
import requests
import json

# Function to force DNS resolution using Cloudflare's DNS
def resolve_hostname(hostname):
    # Cloudflare's DNS servers
    cloudflare_dns = ('1.1.1.1', 53)
    try:
        # Set up a UDP socket
        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        sock.connect(cloudflare_dns)
        # Use the socket to resolve the hostname through Cloudflare's DNS
        ip_address = socket.gethostbyname(hostname)
        sock.close()
        return ip_address
    except Exception as e:
        print(f"Failed to resolve hostname {hostname}: {e}")
        return None

# Function to send a message to the Discord webhook
def send_discord_webhook(webhook_url, message):
    # Extract the hostname from the webhook URL
    hostname = webhook_url.split("/")[2]
    
    # Resolve the hostname using Cloudflare's DNS
    ip_address = resolve_hostname(hostname)
    
    if ip_address:
        # Send the POST request to the resolved IP address
        webhook_data = {
            "content": message
        }
        
        headers = {
            "Content-Type": "application/json"
        }

        try:
            # Send the request with the IP address instead of the hostname
            url = webhook_url.replace(hostname, ip_address)
            response = requests.post(url, data=json.dumps(webhook_data), headers=headers)
            
            if response.status_code == 204:
                print("Message sent successfully!")
            else:
                print(f"Failed to send message. Status code: {response.status_code}")
        except Exception as e:
            print(f"Error sending message: {e}")
    else:
        print("Failed to resolve hostname.")

# Discord webhook URL
webhook_url = "https://discord.com/api/webhooks/1200805594781712506/aUVfkM3l1UFnI22xaDYrol3DifYVabZKWFbSKev1rxDscmELl5nsAX733TdP2ShC74l5"

# Message to send
message = "Hello from a Python script using Cloudflare DNS!"

# Send the message to the Discord webhook
send_discord_webhook(webhook_url, message)
